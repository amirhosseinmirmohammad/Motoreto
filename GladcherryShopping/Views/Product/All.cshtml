@model DataLayer.ViewModels.PagerViewModel.PagerViewModels<DataLayer.Models.Product>
@using MvcPager
@{
    ViewBag.Title = "لیست محصولات";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Metas{
    <meta name="description" content="فروشگاه اینترنتی موتورتو فعال در زمینه فروش انواع قطعات مصرفی خودرو شامل فیلتر روغن ، فیلتر هوا ، فیلتر بنزین ، فیلتر کابین ، روغن موتور و روانکار و غیره است .">
    <meta name="Keywords" content="قطعات مصرفی خودرو">
    <meta property="og:title" content="موتورتو ، فروش آنلاین قطعات خودرو | Motoreto" />
    <meta property="og:url" content="http://www.motoreto.ir/" />
    <meta property="og:image" content="http://www.motoreto.ir/images/sadr_logo.png" />
    <meta name="twitter:image" content="موتورتو ، فروش آنلاین قطعات خودرو | Motoreto">
}

@section Styles{
}
<br />
<div class="container blog_header">
    <div class="row">
        <div class="col-md-12">
            <div class="text-center">
                <h1>لیست محصولات</h1>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div id="product-container" class="row"></div>
    <div id="loader" class="text-center" style="display:none">
        <img src="~/images/loader.gif" alt="Loading..." />
    </div>
</div>

@section Scripts{
    <script>
let page = 1;
let isLoading = false;
const pageSize = 8;

function loadMoreProducts() {
    if (isLoading) return;
    isLoading = true;
    $("#loader").show();

    $.ajax({
        url: '@Url.Action("LoadMoreProducts", "Product")',
        type: "GET",
        data: { page: page, pageSize: pageSize, name: "@ViewBag.CarName" },
        success: function (data) {
            if ($.trim(data) !== "") {
                $("#product-container").append(data);
                page++;
                isLoading = false;
                $("#loader").hide();
            } else {
                $("#loader").hide();
            }
        },
        error: function () {
            isLoading = false;
            $("#loader").hide();
        }
    });
}

// چک کردن نزدیک شدن به انتهای container محصولات
$(window).scroll(function () {
    const scrollTop = $(window).scrollTop();
    const windowHeight = $(window).height();
    const containerBottom = $("#product-container").offset().top + $("#product-container").outerHeight();

    if (scrollTop + windowHeight >= containerBottom - 200) {
        loadMoreProducts();
    }
});

// بارگذاری اولین سری
$(document).ready(function () {
    loadMoreProducts();
});
    </script>
}
